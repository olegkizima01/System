Передмова:
Це адаптоване технічне завдання (ТЗ), що розширює можливості системи до універсального агента з виділеною надійною підсистемою для роботи з кодом.

⸻

ТЕХНІЧНЕ ЗАВДАННЯ
Універсальна Агентна Система з Інтегрованим Контуром Розробки (Dev Subsystem)

⸻

1. Мета системи

Реалізувати універсальну агентну систему, здатну виконувати широкий спектр завдань (рівень людини та вище), з чітким розділенням відповідальності для інженерних задач.

1.1 Універсальність
Система не є вузькоспеціалізованою. Вона повинна обробляти будь-які запити користувача (робота з ОС, браузером, документами тощо).

1.2 Спеціалізація на коді
Якщо завдання стосується розробки, зміни коду, аналізу коду або має будь-який натяк на програмування, воно передається в окремий контур — **Підсистему Розробки**. Це необхідно для забезпечення безпеки та якості змін у вже існуючій стабільній системі.

⸻

2. Архітектура Підсистеми Розробки

Підсистема розробки (Dev Subsystem) реалізує каскадну архітектуру, де **Continue CLI виступає як основний драйвер (посередник)** для взаємодії з IDE.

2.1 Основний потік (Driver Mode: Copilot → Continue CLI → Windsurf)
*   **Роль Continue CLI:** Драйвер. Він слугує транспортним шаром та механізмом керування "руками" для Copilot.
*   **Логіка:** Copilot формує інструкції, а Continue CLI фізично виконує їх доставку у чат Windsurf (імітуючи ввід користувача).
*   **Виконання:** Windsurf отримує текст через драйвер і виконує задачі (написання коду, зміни) своїми силами.

2.2 Режим Відмови (Internal Fallback: Copilot → Continue CLI Native)
*   **Умова:** Якщо драйвер виявляє, що взаємодія з Windsurf неможлива (блокування, помилки UI, відсутність реакції).
*   **Логіка:** Continue CLI перестає намагатися керувати Windsurf і перемикається на власні вбудовані інструменти (context providers, search).
*   **Обмеження:** В цьому режимі діє сувора заборона на модифікацію коду (Write Ban). Дозволено лише читання, аналіз та пошук для діагностики проблеми або надання звіту.

⸻

3. Компоненти системи та Ролі

3.1 Router (Маршрутизатор)
*   Сегрегація задач: General (ОС/Браузер) vs Dev (Код).

3.2 Copilot (Meta-Agent / "Brain")
*   Приймає рішення та керує стратегією.
*   Віддає команди на Continue CLI.

3.3 Continue CLI (The Driver / Interface)
*   **Функція:** Єдина точка входу для Copilot у світ розробки.
*   **Відповідальність:**
    *   Керування інтерфейсом Windsurf (ввід тексту, читання відповіді).
    *   (У разі помилки) Надання прямого доступу до файлової системи (Read-Only).

3.4 Windsurf IDE (Execution Core)
*   Виконавець змін. Copilot через драйвер "просить" Windsurf зробити зміни.

⸻

4. Потік взаємодії (Interaction Flow) для Dev-задач

1.  **Start:** Отримання задачі на розробку.
2.  **Try Mode 1 (Windsurf):**
    *   Copilot формує промпт.
    *   Відправка повідомлення в чат Windsurf.
    *   Очікування та аналіз відповіді.
    *   *Успіх:* Задача виконана → Stop.
    *   *Невдача/Помилка:* Перехід до кроку 3.
3.  **Fallback to Mode 2 (Continue CLI):**
    *   Copilot підключається до середовища через CLI.
    *   Виконує збір інформації (View/Search files).
    *   Формує звіт про ситуацію або план дій (без редагування коду).
    *   Повертає результат користувачеві.

⸻

5. Обмеження та Правила

1.  **Code Safety:** Агент Copilot ніколи не пише в файли коду напряму (ні через Windsurf-чат, бо це робить IDE, ні через Continue CLI, бо це заборонено правилами fallback).
2.  **Separation:** Кодові задачі ізольовані від загальних задач ОС.
3.  **Autonomy:** Система самостійно визначає необхідність переключення в Fallback режим без участі користувача.

⸻

6. Критерій успіху

Система успішно адаптована, якщо вона:
1.  Коректно розрізняє звичайні задачі та задачі розробки.
2.  Для задач розробки пріоритетно використовує Windsurf (імітація користувача).
3.  При збоях безшовно переходить на Continue CLI для аналізу, не порушуючи цілісність коду (read-only).