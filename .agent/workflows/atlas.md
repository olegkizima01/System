---
description: Core Architecture, Workflow, Vision and Current State of Project Atlas (Trinity Runtime) — authoritative document as of December 2025.
---

# Project Atlas: Архітектура, Runtime, Workflow та Візія  
**Актуальний стан на грудень 2025 року**

Цей документ є **єдиним джерелом правди** про те, як працює система зараз, які компоненти вже готові, а які знаходяться в активній розробці. Він поєднує реальний стан коду з довгостроковою візією.

## 1. Мета та філософія проекту

**Atlas** — це локальний нейронний оператор macOS, який вирішує дві тісно пов’язані проблеми:

1. **Приватність та необмежений доступ**  
   Дозволяє інтенсивно використовувати хмарні AI-IDE (Windsurf від Codeium, Antigravity від Google, Cursor та інші) без блокування за device fingerprint, machineId чи обмеженнями на кількість акаунтів.  
   Досягається завдяки потужній системі очищення ідентифікаторів, кешів, keychain, hardware spoofing та автоматизованому режиму «fresh install».

2. **Автономний агент macOS**  
   Еволюція до повноцінного мультиагентного «мозку» комп’ютера, здатного самостійно планувати складні задачі, виконувати їх, перевіряти результати за допомогою зору (vision feedback) та накопичувати досвід.

Проект не приховує першу мету — це ключова цінність для розробників, які працюють з агентними IDE у 2025 році.

## 2. Поточні режими виконання (Execution Engines)

### 2.1 Chat Agent Engine (поточний default)
- Вхід: будь-яке текстове повідомлення в TUI або CLI (`agent-chat`).
- Поведінка:
  - Привітання → швидка статична відповідь.
  - Звичайні запити → LLM (Copilot/GPT-4o або Gemini) з викликами інструментів.
  - Стримінг у зарезервовані рядки логів.
  - Повна підтримка слеш-команд (/help, /streaming, /menu тощо).
- Переваги: швидкий, стабільний, ідеальний для швидких задач та ручного керування IDE.
- Використовується у ~95% взаємодій зараз.

### 2.2 Trinity Graph Runtime (LangGraph) — експериментальний / просунутий
- Розташування: `core/trinity.py`.
- Структура:
  - **Atlas node** — планувальник: розбиває задачу, запитує RAG-пам’ять, формує покроковий план.
  - **Tetyana node** — виконавець: викликає інструменти з MCP-реєстру (filesystem, shell, screenshot, vision, windsurf driver тощо).
  - **Grisha node** — верифікатор: аналізує результати (включаючи скріншоти), вирішує продовжити чи перепланувати.
- Поточний статус:
  - Повністю робочий та запускається через спеціальні точки входу в TUI.
  - Окремий стримінг для кожного агента.
  - Існує, але ще не є досвідом за замовчуванням (за поточним atlas.md: «intended for complex tasks / autopilot-like runs»).
- Обмеження: поки немає чітко агрегованого final_response для користувача — видно лише внутрішній діалог агентів.

## 3. Ключові підсистеми

### 3.1 TUI / CLI інтерфейс (`tui/`)
- Повноцінний текстовий UI на базі prompt_toolkit.
- Панелі: Header, Logs, Context/Agent Messages, Menu, Input, Status.
- Окрема чиста панель повідомлень агентів (Atlas/Tetyana/Grisha) без технічного шуму (tool results, JSON).
- Теми: monaco (за замовчуванням), dracula, nord, gruvbox.
- Багатомовність: основна мова коду та документації — англійська, мова інтерфейсу та чату визначається конфігурацією (`ui_lang` та `chat_lang`). Зараз доступні англійська, українська.
- Unsafe mode (обхід усіх підтверджень).
- Розширене меню: Cleanup, Install, Monitoring, Settings, Custom Tasks.

### 3.2 MCP Tool Registry (`system_ai/tools/`)
- Суворий контракт інструментів — єдиний спосіб взаємодії LLM з системою.
- Основні інструменти:
  - `screenshot`, `capture_screen`
  - `vision` (analyze_screen з GPT-4o-vision)
  - операції з файловою системою
  - `macos_commands`, `macos_native_automation`
  - `run_shell` (з контролем прав)
  - драйвер `windsurf` (відправка повідомлень → Continue CLI → Windsurf IDE)
  - `permissions_manager`

### 3.3 Нове у 2025: IntelliGate — адаптивний міст виконання для Tetyana
Щоб замінити ненадійну ін’єкцію клавіатурних скорочень і підвищити стабільність на сучасних macOS, вводиться новий адаптивний шар виконання:

**IntelliGate** — розумний шлюз виконання задач (планується інтеграція у Q1 2026):
- Динамічно обирає найкращий метод залежно від контексту:
  1. **Нативні MCP-інструменти** (filesystem, shell) — для простих операцій.
  2. **GUI-скриптинг + підтвердження через vision** — коли потрібна взаємодія з інтерфейсом.
  3. **Прямі драйвери IDE** (Windsurf/Antigravity через протокол Continue CLI) — для задач кодування.
  4. **Fallback на AppleScript/UI automation** — тільки коли безпечніших альтернатив немає.
- Переваги над чистими shortcuts:
  - Вища успішність на macOS Sequoia та новіших (де обмеження на скорочення суворіші).
  - Вбудована повторна спроба з верифікацією через vision.
  - Автоматичний запит прав доступу.
  - Менша флакінес у довгих задачах.
- Tetyana node спрямовуватиме дії через IntelliGate замість прямих ін’єкцій клавіш.

### 3.4 Cleanup & Privacy System (`cleanup_scripts/` + `cleanup_modules.json`)
- Найзріліша частина проекту.
- Модульна: вибір IDE → вибір конкретних модулів очищення.
- Підтримувані IDE:
  - **Windsurf** (Codeium) — повний набір, включно з тимчасовим spoofing MAC/hostname + планове повернення через 4 години.
  - **Antigravity** (Google) — глибоке очищення IndexedDB, keychain, скидання до fresh install.
  - **VS Code** — очищення побічних ефектів.
- Доступно як через меню TUI, так і як інструменти.

### 3.5 Memory & RAG (`system_ai/memory/`, `system_ai/rag/`)
- Локальна ChromaDB у `.atlas_memory/`.
- Зберігає успішні стратегії, UI-патерни, звички користувача.
- Використовується вузлом Atlas для контекстно-залежного планування.

## 4. Vision Feedback Loop — майбутнє серце автономності

**Поточний стан**: інструменти є (capture + analyze), але цикл не обов’язковий.  
**Цільова модель** (adaptive verification):
1. Atlas генерує план з вбудованими контрольними точками.
2. Tetyana виконує один крок через IntelliGate.
3. Автоматичний знімок екрану.
4. Grisha + GPT-4o-vision оцінює: «Чи досягнуто очікуваного стану UI?»
5. Успіх → наступний крок; Невдача → перепланування з підвищеною деталізацією (dynamic granularity mode).

## 5. Безпека та права доступу

- **UI Unsafe Mode** — глобально обходить підтвердження (перемикається в меню).
- **TrinityPermissions** — блокує небезпечні інструменти (run_shell, applescript) без явного дозволу.
- **Пауза на запит прав** — агент може зупинитися та чекати схвалення користувача.

## 6. Реалістичний Roadmap (грудень 2025 → 2026)

### Фаза 1: Стабілізація та інтеграція (1–2 місяці)
- Зробити Trinity доступним через префікс у чаті `/trinity` або `/autopilot`.
- Додати чітку агрегацію `final_response` у стані графа → відображення як єдине повідомлення користувачу.
- Експортувати модулі cleanup як звичайні інструменти (`cleanup_windsurf`, `fresh_install_antigravity`).
- Уніфікувати поведінку стримінгу для обох рушіїв.

### Фаза 2: IntelliGate та Vision-центричний Trinity (2–4 місяці)
- Реалізувати IntelliGate як основний міст виконання для Tetyana.
- Поступово відмовитися від прямих ін’єкцій клавіш на користь vision-керованих GUI-дій.
- Зробити vision feedback loop обов’язковим у режимі Trinity.
- Автоматична вставка контрольних точок та порівняння скріншотів за diff.

### Фаза 3: Повна автономія та розширення
- Агент самостійно вирішує, коли запускати cleanup/fresh install перед сесіями IDE.
- Додати нативний драйвер Antigravity (аналог windsurf).
- Розширити RAG вивченими UI-патернами конкретних додатків.
- Експерименти з локальними моделями як fallback.

## 7. Чому проект корисний прямо зараз

- Найкращий інструмент очищення для Windsurf, Antigravity та Cursor — дозволяє працювати без обмежень.
- Потужний контролер ОС через chat agent + багатий набір інструментів.
- Надійна основа (TUI, tools, memory, graph runtime) для справжнього агентного досвіду macOS.
- Чистий, модульний, добре документований код з красивим інтерфейсом.

## 8. Швидкий старт та тести

```bash
./cli.sh                    # запуск TUI
Привіт                      # швидка відповідь
/menu                       # відкрити головне меню
→ Cleanup → Windsurf → Run  # повне очищення + spoofing
/trinity Створи файл test.txt з вмістом "Hello Atlas"
/autopilot Підготуй Windsurf як новий пристрій і відкрий проект X